# ESP32-S3 OV2640 摄像头项目

这是一个基于ESP32-S3和OV2640摄像头的网络视频流项目，实现了实时视频监控和拍照功能。

## 功能特性

- ✅ OV2640摄像头驱动
- ✅ WiFi网络连接
- ✅ HTTP Web服务器
- ✅ 实时MJPEG视频流
- ✅ 网页拍照功能
- ✅ 响应式Web界面
- ✅ 自动重连机制

## 硬件要求

### ESP32-S3开发板
- 支持WiFi和蓝牙
- 建议使用带PSRAM的版本以获得更好的性能

### OV2640摄像头模块
- 支持DVP并行接口
- 支持JPEG输出格式

## 硬件连接

请按照以下引脚连接ESP32-S3和OV2640摄像头：

| OV2640引脚 | ESP32-S3引脚 | 功能描述 |
|------------|--------------|----------|
| VCC        | 3.3V         | 电源正极 |
| GND        | GND          | 电源地   |
| SIOD       | GPIO40       | I2C数据线 |
| SIOC       | GPIO39       | I2C时钟线 |
| Y9         | GPIO48       | 数据位7  |
| Y8         | GPIO11       | 数据位6  |
| Y7         | GPIO12       | 数据位5  |
| Y6         | GPIO14       | 数据位4  |
| Y5         | GPIO16       | 数据位3  |
| Y4         | GPIO18       | 数据位2  |
| Y3         | GPIO17       | 数据位1  |
| Y2         | GPIO15       | 数据位0  |
| VSYNC      | GPIO38       | 垂直同步 |
| HREF       | GPIO47       | 水平参考 |
| PCLK       | GPIO13       | 像素时钟 |
| XCLK       | GPIO10       | 系统时钟 |

## 软件配置

### 1. 环境要求
- ESP-IDF v5.0或更高版本
- Python 3.7或更高版本

### 2. WiFi配置
在 `main/shexiang-ov2640.c` 文件中修改WiFi配置：

```c
const char *ssid = "bed_room_2.4G";      // 修改为您的WiFi名称
const char *password = "Hdk4560.0";      // 修改为您的WiFi密码
```

### 3. 摄像头参数配置
可以在代码中调整以下摄像头参数：

```c
.frame_size = FRAMESIZE_VGA,     // 分辨率：640x480
.jpeg_quality = 12,              // JPEG质量 (0-63)
.xclk_freq_hz = 20000000,       // 时钟频率：20MHz
```

## 编译和烧录

### 1. 配置项目
```bash
idf.py menuconfig
```

### 2. 编译项目
```bash
idf.py build
```

### 3. 烧录到设备
```bash
idf.py -p [PORT] flash monitor
```

## 使用方法

### 1. 启动设备
1. 将ESP32-S3连接到电脑
2. 烧录固件
3. 设备会自动连接到WiFi网络
4. 串口会显示分配的IP地址

### 2. 访问Web界面
1. 在浏览器中输入ESP32-S3的IP地址
2. 页面会自动显示实时视频流
3. 使用"拍照"按钮可以拍摄照片
4. 使用"刷新视频流"按钮可以重新连接视频流

### 3. API接口

#### 视频流
- **URL**: `/stream`
- **方法**: GET
- **格式**: MJPEG视频流
- **用途**: 实时视频监控

#### 拍照
- **URL**: `/capture`
- **方法**: GET
- **格式**: JPEG图像
- **用途**: 拍摄单张照片

#### 主页
- **URL**: `/`
- **方法**: GET
- **格式**: HTML页面
- **用途**: 显示控制界面

## 故障排除

### 常见问题

1. **摄像头初始化失败**
   - 检查硬件连接是否正确
   - 确认摄像头模块是否损坏
   - 检查电源电压是否稳定

2. **WiFi连接失败**
   - 确认WiFi名称和密码正确
   - 检查WiFi信号强度
   - 确认WiFi加密方式支持

3. **视频流无法显示**
   - 检查网络连接是否正常
   - 确认浏览器支持MJPEG格式
   - 尝试刷新页面或重新连接

4. **图像质量差**
   - 调整JPEG质量参数
   - 检查环境光线条件
   - 调整摄像头对焦

### 调试信息
通过串口监视器可以查看详细的调试信息：
- 系统启动状态
- WiFi连接状态
- 摄像头初始化状态
- 网络请求日志

## 性能优化

### 1. 内存优化
- 使用PSRAM版本的ESP32-S3
- 调整帧缓冲区数量
- 优化JPEG质量设置

### 2. 网络优化
- 使用5GHz WiFi网络
- 减少网络延迟
- 优化HTTP服务器配置

### 3. 图像质量优化
- 根据环境调整曝光参数
- 优化白平衡设置
- 调整对比度和饱和度

## 扩展功能

### 1. 存储功能
- 添加SD卡支持
- 实现图像本地存储
- 支持录像功能

### 2. 网络功能
- 支持RTSP流媒体
- 实现云存储上传
- 添加移动端应用

### 3. 智能功能
- 人脸识别
- 运动检测
- 图像分析

## 许可证

本项目采用MIT许可证，详见LICENSE文件。

## 贡献

欢迎提交Issue和Pull Request来改进项目。

## 联系方式

如有问题或建议，请通过以下方式联系：
- 提交GitHub Issue
- 发送邮件至项目维护者

---

**注意**: 使用本项目时请遵守当地法律法规，不得用于非法用途。